[{"code":"class w{_getParticipantsForUser(e,t){var n,r,i;let o,y=[],O=f.A.getVoiceStateForChannel(this.channelId,e);if(null==O)return y;let A=d.default.getUser(e);if(null==A)return null!=this.guildId&&m.A.isPublic(this.channelId)&&l.A.requestMember(this.guildId,e),y;let I=null!=t?t[0]:null,S=null!=this.guildId?c.Ay.getMember(this.guildId,e):null,T=null!=(n=null==S?void 0:S.nick)?n:_.Ay.getName(this.guildId,this.channelId,A),C={user:A,userNick:_.Ay.getName(this.guildId,this.channelId,A),nick:T,comparator:(0,p.hz)(O,T),voiceState:O,role:(0,E.l)(this.guildId,e),speaker:h.Ay.isSpeaker(e,this.channelId),member:S,blocked:u.A.isBlocked(A.id),ignored:u.A.isIgnored(A.id),isFriend:u.A.isFriend(A.id),connectedOn:null!=(r=null==I?void 0:I.connectedOn)?r:Date.now()},N=v(b({},C),{type:\"VOICE\",id:A.id,rtsState:(0,g.eY)(O)});y.push(N);let w=null!=(i=s.A.getStreamForUser(e,this.guildId))?i:s.A.getActiveStreamForUser(e,this.guildId);if(null!=w&&w.channelId===this.channelId){let e=(0,a._z)(w);o=v(b({},C),{id:e,type:\"STREAM\",rtsState:g.zF.NONE}),y.push(o)}return y}updateParticipant(e){let t=this.participants[e],n=this._getParticipantsForUser(e,t);return(null!=t||0!==n.length)&&(null==t||t.forEach(e=>{this._participantsIndex.delete(e.id),this._requestToSpeakIndex.delete(e.id)}),n.forEach(t=>{this._participantsIndex.set(t.id,t),t.id===e&&C(t.rtsState)?this._requestToSpeakIndex.set(e,t):this._requestToSpeakIndex.delete(e)}),this.participants[e]=n,!0)}rebuild(){let e=o.A.getChannel(this.channelId);if(null==e||!e.isGuildStageVoice())return!1;let t=new Set(Object.keys(f.A.getVoiceStatesForChannel(e.id)));return this._participantsIndex.clear(),this._requestToSpeakIndex.clear(),this.participants={},t.forEach(e=>this.updateParticipant(e)),!0}get version(){return this._participantsIndex.version}size(e){return this._participantsIndex.size(e)}toArray(e){return this._participantsIndex.values(e,!0)}getParticipant(e){var t;return null!=(t=this._participantsIndex.get(e))?t:null}get requestToSpeakVersion(){return this._requestToSpeakIndex.version}getRequestToSpeakParticipants(){return this._requestToSpeakIndex.values(void 0,!0)}constructor(e){var t;y(this,\"channelId\",void 0),y(this,\"guildId\",void 0),y(this,\"participants\",{}),y(this,\"_participantsIndex\",new r.J(N,S)),y(this,\"_requestToSpeakIndex\",new r.J(()=>[],T)),this.channelId=e,this.guildId=null==(t=o.A.getChannel(e))?void 0:t.getGuildId()}}"}]