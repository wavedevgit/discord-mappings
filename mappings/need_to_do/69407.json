[{"code":"class R{_getParticipantsForUser(e,t){var n,r,i;let o,b=[],O=f.A.getVoiceStateForChannel(this.channelId,e);if(null==O)return b;let v=d.default.getUser(e);if(null==v)return null!=this.guildId&&m.A.isPublic(this.channelId)&&l.A.requestMember(this.guildId,e),b;let S=null!=t?t[0]:null,I=null!=this.guildId?c.Ay.getMember(this.guildId,e):null,T=null!=(n=null==I?void 0:I.nick)?n:_.Ay.getName(this.guildId,this.channelId,v),C={user:v,userNick:_.Ay.getName(this.guildId,this.channelId,v),nick:T,comparator:(0,p.hz)(O,T),voiceState:O,role:(0,E.l)(this.guildId,e),speaker:h.Ay.isSpeaker(e,this.channelId),member:I,blocked:u.A.isBlocked(v.id),ignored:u.A.isIgnored(v.id),isFriend:u.A.isFriend(v.id),connectedOn:null!=(r=null==S?void 0:S.connectedOn)?r:Date.now()},N=A(y({},C),{type:\"VOICE\",id:v.id,rtsState:(0,g.eY)(O)});b.push(N);let R=null!=(i=s.A.getStreamForUser(e,this.guildId))?i:s.A.getActiveStreamForUser(e,this.guildId);if(null!=R&&R.channelId===this.channelId){let e=(0,a._z)(R);o=A(y({},C),{id:e,type:\"STREAM\",rtsState:g.zF.NONE}),b.push(o)}return b}updateParticipant(e){let t=this.participants[e],n=this._getParticipantsForUser(e,t);return(null!=t||0!==n.length)&&(null==t||t.forEach(e=>{this._participantsIndex.delete(e.id),this._requestToSpeakIndex.delete(e.id)}),n.forEach(t=>{this._participantsIndex.set(t.id,t),t.id===e&&C(t.rtsState)?this._requestToSpeakIndex.set(e,t):this._requestToSpeakIndex.delete(e)}),this.participants[e]=n,!0)}rebuild(){let e=o.A.getChannel(this.channelId);if(null==e||!e.isGuildStageVoice())return!1;let t=new Set(Object.keys(f.A.getVoiceStatesForChannel(e.id)));return this._participantsIndex.clear(),this._requestToSpeakIndex.clear(),this.participants={},t.forEach(e=>this.updateParticipant(e)),!0}get version(){return this._participantsIndex.version}size(e){return this._participantsIndex.size(e)}toArray(e){return this._participantsIndex.values(e,!0)}getParticipant(e){var t;return null!=(t=this._participantsIndex.get(e))?t:null}get requestToSpeakVersion(){return this._requestToSpeakIndex.version}getRequestToSpeakParticipants(){return this._requestToSpeakIndex.values(void 0,!0)}constructor(e){var t;b(this,\"channelId\",void 0),b(this,\"guildId\",void 0),b(this,\"participants\",{}),b(this,\"_participantsIndex\",new r.J(N,I)),b(this,\"_requestToSpeakIndex\",new r.J(()=>[],T)),this.channelId=e,this.guildId=null==(t=o.A.getChannel(e))?void 0:t.getGuildId()}}"}]