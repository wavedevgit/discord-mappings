[{"code":"class k extends i.Component{_getEditorWindow(){var e,t,n,r,i;let a=null==(i=this.ref)||null==(r=i.current)||null==(n=r.getSlateEditor)||null==(t=n.call(r))||null==(e=t.windowContext)?void 0:e.renderWindow;if(null==this._cachedEditorWindow||this._cachedEditorWindow!==a){if(null!=this._cachedEditorWindow&&null==a)return null;this._cachedEditorWindow=null!=a?a:window}return this._cachedEditorWindow}componentDidMount(){this.props.focused&&requestAnimationFrame(()=>this.focus()),document.addEventListener(\"selectionchange\",this.handleSelectionChange),window.addEventListener(\"beforeunload\",this.handleBeforeUnload),this._initTimeoutId=setTimeout(()=>void this._getEditorWindow(),j)}componentDidUpdate(e){if(this.fixFocus(e),this.props.useSlate!==e.useSlate){var t,n;let e;e=this.props.useSlate?this.props.textValue:(0,C.WO)(this.props.richValue,{mode:\"plain\"}),null==(t=(n=this.props).onChange)||t.call(n,null,e,(0,v.x7)(e))}else this.props.textValue!==e.textValue&&this.saveCurrentTextThrottled()}componentWillUnmount(){var e,t;this.saveCurrentText(),null==(e=(t=this)._unsubscribe)||e.call(t),window.removeEventListener(\"beforeunload\",this.handleBeforeUnload),document.removeEventListener(\"selectionchange\",this.handleSelectionChange),this._focusBlurQueue=null,this._unsubscribe=null,this._cachedEditorWindow=null,null!=this._initTimeoutId&&clearTimeout(this._initTimeoutId)}blur(){let e=this.ref.current;null!=e&&e.blur()}submit(e){var t;null==(t=this.ref.current)||t.submit(e)}insertEmoji(e){let{emoji:t,willClose:n}=e,r=this.ref.current;null!=t&&null!=r&&(r.insertEmoji({emoji:t,addSpace:n}),n&&this.focus())}insertGIF(e){let{textValue:t}=this.props,n=this.ref.current;null!=e&&null!=n&&(t.endsWith(\" \")||n.insertText(\" \",void 0,!1),n.insertText(e.url))}insertSound(e){let{textValue:t}=this.props,n=this.ref.current;null!=e&&null!=n&&(t.endsWith(\" \")||n.insertText(\" \",void 0,!1),n.insertText(\"<sound:\".concat(e.guildId,\":\").concat(e.soundId,\">\"),void 0,!0))}handleOuterClick(){this.focus()}clearValue(){let{channel:e,type:t}=this.props;this.setState({focused:!0,submitting:!1}),u.A.saveDraft(e.id,\"\",t.drafts.type)}getCurrentWord(){var e;let t=this.ref.current;return null!=(e=null==t?void 0:t.getCurrentWord())?e:{word:null,isAtStart:!1}}insertAutocomplete(e,t,n){let r=this.ref.current;return null==r?void 0:r.insertAutocomplete(e,t,n)}insertInlineAutocompleteElement(e){let t=this.ref.current;return null==t?void 0:t.insertInlineAutocompleteInput(e)}replaceInlineAutocompleteInput(e,t,n){let r=this.ref.current;return null==r?void 0:r.replaceInlineAutocompleteInput(e,t,n)}getCurrentCommandOption(){var e,t;let n=this.ref.current;return null!=(e=null==n||null==(t=n.getCurrentCommandOption)?void 0:t.call(n))?e:null}getCurrentCommandOptionValue(){var e,t;let n=this.ref.current;return null!=(e=null==n||null==(t=n.getCurrentCommandOptionValue)?void 0:t.call(n))?e:[]}getCommandOptionValues(){var e,t;let n=this.ref.current;return null!=(e=null==n||null==(t=n.getCommandOptionValues)?void 0:t.call(n))?e:{}}getFirstText(){var e;let t=this.ref.current;return null!=(e=null==t?void 0:t.getFirstText())?e:null}getSlateEditor(){var e,t;let n=this.ref.current;return null!=(e=null==n||null==(t=n.getSlateEditor)?void 0:t.call(n))?e:null}fixFocus(e){e.focused&&!this.props.focused?this.blur():!e.focused&&this.props.focused&&this.focus()}appendText(e,t){var n;let r=!(arguments.length>2)||void 0===arguments[2]||arguments[2];null==(n=this.ref.current)||n.insertText(e,t,r)}getPlaceholder(){let{disabled:e,placeholder:t,isPreviewing:n,showValueWhenDisabled:r}=this.props;return e&&!n?r?\"\":w.intl.string(w.t.IYKTTc):t}render(){var e,t,n,i,a,s;let{textValue:l,richValue:u,disabled:d,onChange:f,onKeyDown:p,onResize:_,onSubmit:h,onSubmitFailure:m,channel:g,type:y,useSlate:b,spellcheckEnabled:A,useNewSlashCommands:I,canOnlyUseTextCommands:C,className:w,id:P,required:L,maxCharacterCount:M,allowNewLines:j,isEditorIdle:k,currentAutocompleteType:U,\"aria-describedby\":G,\"aria-labelledby\":F,accessibilityLabel:V,showValueWhenDisabled:B}=this.props,{submitting:H,popup:Y}=this.state,W={channel:g,className:o()(w,R.Tg,{[R.w5]:b,[R.Rr]:d||H}),id:P,placeholder:this.getPlaceholder(),required:L,accessibilityLabel:V,disabled:d||!1,submitting:H,isEdit:y===O.oU.EDIT,onFocus:this.handleFocus,onBlur:this.handleBlur,onPaste:this.handlePaste,onTab:this.handleTab,onEnter:this.handleEnter,moveSelection:this.handleMoveSelection,maybeShowAutocomplete:this.maybeShowAutocomplete,hideAutocomplete:this.hideAutocomplete,allowNewLines:j,onChange:f,onResize:_,onKeyDown:p,onSubmit:h,textAreaPaddingClassName:o()({[R.H$]:y===O.oU.CREATE_FORUM_POST,[R.g_]:y===O.oU.CUSTOM_GIFT,[R.Yg]:y===O.oU.USER_PROFILE,[R.$$]:y===O.oU.OVERLAY_INLINE_REPLY}),spellcheckEnabled:A,useNewSlashCommands:I,isEditorIdle:k,currentAutocompleteType:U,disableAutoFocus:c.Fr||null!=(e=y.disableAutoFocus)&&e,disableEnterToSubmit:null!=(t=null==(a=y.submit)?void 0:a.disableEnterToSubmit)&&t,\"aria-controls\":null!=(n=Y.id)?n:void 0,\"aria-haspopup\":\"listbox\",\"aria-expanded\":null!==Y.id||void 0,\"aria-activedescendant\":null!=(i=Y.activeDescendant)?i:void 0,\"aria-invalid\":l.length>M,\"aria-describedby\":G,\"aria-labelledby\":F,\"aria-autocomplete\":\"list\"},K=b?(0,r.jsx)(T.A,x(D({ref:this.ref},W),{type:y,value:d&&!B?(0,v.x7)(\"\"):u,canUseCommands:null==(s=y.commands)?void 0:s.enabled,canOnlyUseTextCommands:C,onSubmitFailure:m})):(0,r.jsx)(S.A,x(D({ref:this.ref},W),{value:d&&!B?\"\":l}));return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(E.EG,{event:N.jej.INSERT_TEXT,handler:this.handleInsertText}),(0,r.jsx)(E.EG,{event:N.jej.CLEAR_TEXT,handler:this.handleClearText}),K]})}constructor(e){var t;super(e),t=this,P(this,\"ref\",i.createRef()),P(this,\"_focusBlurQueue\",Promise.resolve()),P(this,\"_unsubscribe\",void 0),P(this,\"_initTimeoutId\",null),P(this,\"_cachedEditorWindow\",null),P(this,\"handleSelectionChange\",()=>{if(this.props.focused){var e,t,n;this.props.onSelectionChanged(null==(t=(n=document).getSelection)||null==(e=t.call(n))?void 0:e.toString())}}),P(this,\"focus\",()=>{var e;null==(e=this._focusBlurQueue)||e.then(()=>{this.setState({focused:!0},()=>{let e=this.ref.current;null!=e&&e.focus()})})}),P(this,\"saveCurrentText\",function(){let e=!(arguments.length>0)||void 0===arguments[0]||arguments[0],{type:n,channel:r}=t.props;n.drafts.autoSave&&(e&&t.saveCurrentTextThrottled.cancel(),t.handleSaveCurrentText(r.id))}),P(this,\"handleBeforeUnload\",()=>this.saveCurrentText()),P(this,\"saveCurrentTextThrottled\",l().throttle(this.saveCurrentText.bind(this,!1),500)),P(this,\"handleEnter\",e=>{var t,n;return null==(t=(n=this.props).onEnter)?void 0:t.call(n,e)}),P(this,\"handleTab\",()=>{var e,t;return null==(e=(t=this.props).onTab)?void 0:e.call(t)}),P(this,\"handleMoveSelection\",e=>{var t,n;return null==(t=(n=this.props).onMoveSelection)?void 0:t.call(n,e)}),P(this,\"maybeShowAutocomplete\",()=>{var e,t;return null==(e=(t=this.props).onMaybeShowAutocomplete)?void 0:e.call(t)}),P(this,\"hideAutocomplete\",()=>{var e,t;return null==(e=(t=this.props).onHideAutocomplete)?void 0:e.call(t)}),P(this,\"handleSaveCurrentText\",e=>{u.A.saveDraft(e,this.props.textValue,this.props.type.drafts.type)}),P(this,\"handleClearText\",()=>{var e,t;null==(e=(t=this.props).onChange)||e.call(t,null,\"\",(0,v.x7)(\"\"))}),P(this,\"handleInsertText\",e=>{let{plainText:t,rawText:n,addSpace:r=!1}=e;this.props.disabled||(this.appendText(t,n,r),this.focus())}),P(this,\"handleFocus\",e=>{let{onFocus:t}=this.props,{focused:n}=this.state;null==t||t(e),n||this.setState({focused:!0})}),P(this,\"handleBlur\",e=>{let{onBlur:t}=this.props,{focused:n}=this.state;null==t||t(e),n&&this.setState({focused:!1})}),P(this,\"handlePaste\",e=>{var t,n,r;let i=null==(r=e.target)||null==(n=r.ownerDocument)?void 0:n.defaultView,{channel:a,canPasteFiles:o,uploadPromptCharacterCount:s,promptToUpload:l,maxCharacterCount:c,type:u}=this.props,m=null!=i?(0,I.VG)(i):null,E=(0,I.W7)(),y=null!=(t=null!=m?m:E)?t:a,b=(0,I.qH)(i,this._getEditorWindow())?a:y;if(null==l||!b.isPrivate()&&!o||b.isPrivate()&&b.isManaged())return!1;let O=e=>{var t,n;let r=h.A.getActiveCommand(b.id);if(null==r)return l(e,b,u.drafts.type,{requireConfirm:!0,origin:\"clipboard\"});let i=null!=(t=u.drafts.commandType)?t:u.drafts.type,a=null,o=h.A.getActiveOption(b.id);null!=(a=(null==o?void 0:o.type)===p.n4.ATTACHMENT?o:null==(n=r.options)?void 0:n.find(e=>{if(e.type===p.n4.ATTACHMENT)return null==g.A.getUpload(b.id,e.name,i)}))&&d.A.setFile({channelId:b.id,id:a.name,draftType:i,file:{id:a.name,platform:_.xz.WEB,file:e[0]}})},v=null!=s?s:c,{files:A,errors:S}=U(e.clipboardData,u.uploadLongMessages?v:null);return(M(\"onPaste\",[...e.clipboardData.items].map(e=>{if(\"file\"!==e.kind)return{kind:e.kind,type:e.type};{let t=e.getAsFile();return{kind:e.kind,type:e.type,name:null==t?void 0:t.name,path:null==t?void 0:t.path}}})),0===A.length)?((null==S?void 0:S.some(e=>{let{error:t}=e;return\"is_directory\"===t}))&&(0,f.openUploadError)({title:w.intl.string(w.t.azO1Pe),help:w.intl.string(w.t[\"Koklr/\"])}),!1):(e.preventDefault(),e.stopPropagation(),this.saveCurrentText(),O(A),this.focus(),!0)}),this._unsubscribe=A.Y0.subscribe(e=>{requestAnimationFrame(()=>{this.setState({popup:e})})}),this.state={focused:!1,submitting:!1,popup:A.Y0.getState()}}}"}]