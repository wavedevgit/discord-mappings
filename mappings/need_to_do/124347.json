[{"code":"class R extends(r=a.Component){static isAnimated(e){let{src:t,original:n,animated:r,srcIsAnimated:i}=e;return r||T.test(null!=n&&\"\"!==n?n:t)||null!=i&&i&&(C.test(null!=n&&\"\"!==n?n:t)||A.test(null!=n&&\"\"!==n?n:t))}static isSrcPNG(e){let{src:t}=e;return N.test(t)}static isSrcAVIF(e){let{src:t}=e;return A.test(t)}static getFormatQuality(e){let{src:t,original:n,animated:r,srcIsAnimated:i,freeze:a=!1}=e,o=null,s=null;return g.$k&&(a||!R.isAnimated({src:t,original:n,animated:r,srcIsAnimated:i}))?(o=\"webp\",(R.isSrcPNG({src:t})||R.isSrcAVIF({src:t}))&&(s=\"lossless\")):a&&(o=\"png\"),{format:o,quality:s}}static preloadImage(e){let{src:t,dimensions:{maxWidth:n,maxHeight:r,imageWidth:i,imageHeight:a},options:{srcIsAnimated:o,original:s,animated:l,sourceMetadata:c,freeze:u},callback:d}=e;if(1===i&&1===a)return;let{format:p,quality:_}=R.getFormatQuality({src:t,original:s,animated:l,srcIsAnimated:o,freeze:u}),h=(0,f.Q4)({src:t,width:i,height:a,maxWidth:n,maxHeight:r,srcIsAnimated:o,format:p,quality:_}),m=Date.now();return(0,f.po)(h,(e,n)=>{R.trackLoadingCompleted({error:e,imageData:n,trigger:\"PRELOAD\",startLoadingTime:m,readyState:b.zo9.READY,format:p,quality:_,imageProps:{src:t,width:i,height:a,sourceMetadata:c,original:s}}),null==d||d(e,n)})}static async trackLoadingCompleted(e){var t,n,r;let{error:i,imageData:a,trigger:o,startLoadingTime:l,readyState:c,format:u,quality:d,imageProps:{src:f,height:g,width:E,original:y,sourceMetadata:O}}=e;if(i&&p.Z.increment({name:s.V.IMAGE_LOAD_ERROR}),!D.getCurrentConfig({location:\"lazy_image\"}).enabled)return;let v=await fetch(a.url).catch(()=>void 0),S=null==v||null==(t=v.headers)?void 0:t.get(\"content-length\"),I=null!=S?Number(S):null,T=Date.now()-l;m.default.track(b.rMx.IMAGE_LOADING_COMPLETED,{duration_ms:T,requested_height:a.height,requested_width:a.width,height:g,width:E,original_url:y,url:f,requested_url:a.url,format:u,quality:d,state:i?b.zo9.ERROR:c,data_saving_mode:_.ZP.dataSavingMode,low_quality_image_mode:_.ZP.dataSavingMode,trigger:o,size:I,message_id:null==O||null==(n=O.message)?void 0:n.id,message_sent_timestamp:null==O||null==(r=O.message)?void 0:r.timestamp.getTime(),connection_type:h.Z.getType(),effective_connection_speed:h.Z.getEffectiveConnectionSpeed(),service_provider:h.Z.getServiceProvider()})}componentDidMount(){let{readyState:e}=this.state;e===b.zo9.LOADING&&this.loadImage(this.getSrc(this.getRatio(),R.isAnimated(this.props)),this.handleImageLoad),R.isAnimated(this.props)&&this.observeVisibility()}componentDidUpdate(e){let t=R.isAnimated(this.props);R.isAnimated(e)!==t&&(t?this.observeVisibility():this.unobserveVisibility())}componentWillUnmount(){R.isAnimated(this.props)&&this.unobserveVisibility(),this._cancellers.forEach(e=>e()),this._cancellers.clear()}getSrc(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],{src:n,width:r,height:i,maxWidth:a,maxHeight:o,mediaLayoutType:s}=this.props,{format:l,quality:c}=R.getFormatQuality(I(v({},this.props),{freeze:t}));return(0,f.Q4)({src:n,width:r,height:i,ratio:e,maxWidth:s===y.hV.MOSAIC?a:void 0,maxHeight:s===y.hV.MOSAIC?o:void 0,format:l,quality:c,animated:!t,srcIsAnimated:this.props.srcIsAnimated})}getRatio(){let{width:e,height:t,maxWidth:n=P,maxHeight:r=w,mediaLayoutType:i,useFullWidth:a}=this.props;return i===y.hV.MOSAIC&&a?(0,E.rn)({width:e,height:t,maxWidth:n,maxHeight:r}):(0,E.Dc)({width:e,height:t,maxWidth:n,maxHeight:r})}getType(){let{mediaLayoutType:e,responsive:t}=this.props;return null!=e?e:t?y.hV.RESPONSIVE:y.hV.STATIC}loadImage(e,t){let{width:n,height:r}=this.props;if(this.startLoadingTime=Date.now(),1===n&&1===r)return;let i=(0,f.po)(e,(e,n)=>{null!=i&&this._cancellers.delete(i),null==t||t(e,n)});null!=i&&this._cancellers.add(i)}render(){let{alt:e,zoomThumbnailPlaceholder:t,onZoom:n,shouldLink:r,onContextMenu:a,autoPlay:s,original:l,className:u,imageClassName:d,children:f,animated:p,shouldAnimate:_,width:h,height:m,minWidth:g,minHeight:E,maxWidth:y,maxHeight:O,onClick:S,renderAccessory:I,tabIndex:T,limitResponsiveWidth:C,useFullWidth:A,placeholder:N,placeholderVersion:P,dataSafeSrc:w,srcIsAnimated:D}=this.props,{readyState:x,hasMouseOver:L,hasFocus:j}=this.state,M=null!=n,k=this.getRatio(),U=(0,o.clamp)(Math.round(h*k),null!=g?g:0,null!=y?y:1/0),G=(0,o.clamp)(Math.round(m*k),null!=E?E:0,null!=O?O:1/0),Z={alt:e,readyState:x,onContextMenu:null!=a?a:void 0,zoomable:M,className:u,imageClassName:d,minWidth:g,minHeight:E,mediaLayoutType:this.getType(),limitResponsiveWidth:C,useFullWidth:A,tabIndex:T,width:U,height:G,src:\"\",placeholder:N,placeholderVersion:P,dataSafeSrc:w,srcIsAnimated:D,children:null!=f?e=>{let{src:t,size:n,alt:r,mediaLayoutType:i}=e;return f({src:t,size:n,alt:r,mediaLayoutType:i})}:void 0,onMouseEnter:this.onMouseEnter,onMouseLeave:this.onMouseLeave,onFocus:this.onFocus,onBlur:this.onBlur};if(1===Z.width&&1===Z.height)return null;switch((M||null!=S)&&(Z.onClick=this.onClick),r&&(Z.original=null!=l&&\"\"!==l?l:Z.src),x){case b.zo9.LOADING:null!=t&&(Z.src=t);break;case b.zo9.READY:if(R.isAnimated(this.props)){Z.onMouseLeave=this.onMouseLeave;let e=(s||L||j)&&(null==_||_)&&R.visibilityObserver.isVisible(this);e?(Z.src=this.getSrc(k),Z.renderAccessory=I):(Z.src=this.getSrc(k,!p||!s),Z.renderAccessory=this.renderAccessory),null!=f&&(Z.children=t=>{let{src:n,size:r,alt:i,mediaLayoutType:a}=t;return f({src:n,size:r,animating:e,alt:i,mediaLayoutType:a})})}else Z.src=this.getSrc(k)}return(0,i.jsx)(c.E,v({ref:this._imageRef},Z))}constructor(e){super(e),O(this,\"state\",{readyState:b.zo9.LOADING,hasMouseOver:!1,hasFocus:!1}),O(this,\"startLoadingTime\",Date.now()),O(this,\"_cancellers\",new Set),O(this,\"_imageRef\",a.createRef()),O(this,\"observeVisibility\",()=>{R.visibilityObserver.observe(this,this._imageRef)}),O(this,\"unobserveVisibility\",()=>{R.visibilityObserver.unobserve(this)}),O(this,\"handleImageLoad\",(e,t)=>{this.setState({readyState:e?b.zo9.ERROR:b.zo9.READY},()=>{var n;let{format:r,quality:i}=R.getFormatQuality(this.props);R.trackLoadingCompleted({error:e,imageData:t,trigger:null!=(n=this.props.trigger)?n:\"LOAD\",startLoadingTime:this.startLoadingTime,readyState:this.state.readyState,format:r,quality:i,imageProps:this.props})})}),O(this,\"onMouseEnter\",e=>{R.isAnimated(this.props)&&this.setState({hasMouseOver:!0});let{onMouseEnter:t}=this.props;null==t||t(e)}),O(this,\"onMouseLeave\",e=>{R.isAnimated(this.props)&&this.setState({hasMouseOver:!1});let{onMouseLeave:t}=this.props;null==t||t(e)}),O(this,\"onFocus\",e=>{R.isAnimated(this.props)&&this.setState({hasFocus:!0})}),O(this,\"onBlur\",e=>{let{currentTarget:t,relatedTarget:n}=e;t.contains(n)||this.setState({hasFocus:!1})}),O(this,\"onClick\",e=>{let{onZoom:t,onClick:n}=this.props;null!=n?n(e):null!=t&&(e.preventDefault(),t(e,{zoomThumbnailPlaceholder:this.getSrc(this.getRatio()),trigger:\"CLICK\"}))}),O(this,\"renderAccessory\",()=>{let{hasMouseOver:e,hasFocus:t}=this.state,n=e||t,r=null!=this.props.renderAccessory?this.props.renderAccessory():null;return this.props.shouldRenderAccessory?n?r:(0,i.jsx)(d.Z,{}):null}),(0,f.Vv)(this.getSrc(this.getRatio(),R.isAnimated(this.props)))&&(this.state.readyState=b.zo9.READY)}}"}]