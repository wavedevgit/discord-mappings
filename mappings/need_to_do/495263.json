[{"code":"async function y(e){let{setPurchaseState:t,setHasAcceptedTerms:n,setIsSubmitting:r,setPurchaseError:m,hasRedirectURL:E,setHasRedirectURL:y,isGift:O,baseAnalyticsData:A,analyticsLocation:v,analyticsLocations:S,flowStartTime:I,subscriptionPlan:T,planGroup:C,trialId:N,priceOptions:R,paymentSource:w,isPrepaidPaymentPastDue:P,openInvoiceId:D,premiumSubscription:x,onNext:L,metadata:j,sku:M,skuPricePreview:k,purchaseType:U,referralCode:G,loadId:V,giftInfoOptions:F,invoicePreview:B,orderId:H}=e;t(p.h.PURCHASING),n(!0),r(!0),a.h.wait(o.ET),m(null);try{let e,n,r,a;if(d.default.track(_.HAw.PAYMENT_FLOW_COMPLETED,b(g({},A),{subtotal:null==B?void 0:B.subtotal,tax:null==B?void 0:B.tax,expected_amount:null==B?void 0:B.total,expected_currency:null==B?void 0:B.currency,duration_ms:Date.now()-I})),E)return;if(U===_.VVm.ONE_TIME)i()(null!=M,\"SKU must exist and be fetched.\"),i()(null!=k,\"SKUPricePreview must exist.\"),e=await (0,c.XU)(M.applicationId,M.id,{expectedAmount:k.amount,expectedCurrency:k.currency,isGift:O,paymentSource:w,loadId:V,giftInfoOptions:F,orderId:H});else{i()(null!=T,\"Missing subscriptionPlan\"),i()(null!=B,\"Missing invoicePreview\");let t={amount:B.total,currency:B.currency},n=(0,f.$Q)((0,f.y8)(T.id,!1,!1,R));if(null!=x){let e=(0,f.Pg)(x,T.id,1,new Set(C));e=(0,f.qn)(e),n=(0,f.UC)(e,R.currency.toLowerCase(),R.paymentSourceId)}if(O){let t=B.total,n=B.currency;e=await (0,c.XU)(h.tv,T.skuId,{expectedAmount:t,expectedCurrency:n,paymentSource:w,subscriptionPlanId:T.id,isGift:!0,loadId:V,giftInfoOptions:F,orderId:H})}else if(P&&null!=D&&null!=w&&null!=x)e=_.AD1.has(w.type)?await (0,s.LD)(x,D,w,R.currency):await (0,s.nV)(x,{paymentSource:w,currency:R.currency},t,n,S,v,V);else if(null!=x){let r=(0,f.Pg)(x,T.id,1,new Set(C)),i={paymentSource:w,currency:R.currency};x.status===_.Dmq.PAUSED&&(i.status=_.Dmq.ACTIVE),x.isPausedAllowsResumeButNotUpdates||(i.items=r),e=await (0,s.nV)(x,i,t,n,S,v,V)}else e=await (0,l.B1)({planId:T.id,currency:R.currency,paymentSource:w,trialId:N,metadata:j,referralCode:G,loadId:V,expectedInvoicePrice:t,expectedRenewalPrice:n})}if(e.redirectConfirmation)return void y(null!=e.redirectURL);t(p.h.COMPLETED),\"subscription\"in e?n=null!=e.subscription?u.A.createFromServer(e.subscription):null:\"entitlements\"in e&&(r=null!=e.entitlements?e.entitlements:void 0),\"appliedUserDiscounts\"in e&&(a=null!=e.appliedUserDiscounts&&e.appliedUserDiscounts.length>0?e.appliedUserDiscounts:void 0),L(n,r,a)}catch(e){t(p.h.FAIL),m(e),d.default.track(_.HAw.PAYMENT_FLOW_FAILED,b(g({},A),{payment_error_code:null==e?void 0:e.code,payment_source_id:null==w?void 0:w.id,payment_source_type:null==w?void 0:w.type,duration_ms:Date.now()-I}))}finally{E||r(!1)}}"}]