[{"code":"class h{overwriteHistory(e,t){this.usageHistory=i().mapValues(null!=e?e:{},e=>u(l({},e),{frecency:-1})),null==t||t.forEach(e=>{let{key:t,timestamp:n}=e;return this.track(t,{timestamp:n})}),this.markDirty()}markDirty(){this.dirty=!0}isDirty(){return this.dirty}track(e){let{timestamp:t,usesSinceLastTrack:n}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(null==e)return;let r=Object.hasOwn(this.usageHistory,e)?this.usageHistory[e]:void 0;if(null==r)r={totalUses:null!=n?n:1,recentUses:[null!=t?t:Date.now()],frecency:-1,score:0};else for(r.frecency=-1,r.totalUses+=null!=n?n:1,null==t?r.recentUses.push(Date.now()):(r.recentUses.push(t),r.recentUses.sort());r.recentUses.length>this.maxSamples;)r.recentUses.shift();this.usageHistory[e]=r,this.markDirty()}getEntry(e){return null==e?null:(this.dirty&&this.compute(),Object.prototype.hasOwnProperty.call(this.usageHistory,e)?this.usageHistory[e]:void 0)}getScore(e){let t=this.getEntry(e);return null!=t?t.score:null}getFrecency(e){let t=this.getEntry(e);return null!=t?t.frecency:null}compute(){let e=s()(),t=this.calculateMaxTotalUse?i().maxBy(Object.values(this.usageHistory),e=>e.totalUses):null;i().forEach(this.usageHistory,(n,r)=>{let{totalUses:a,recentUses:o,frecency:l}=n;if(-1!==l)return;let c=this.computeBonus(r)/100;n.score=0,i().forEach(o,(t,r)=>{if(r>=this.maxSamples)return!1;let i=this.computeWeight(e.diff(s()(t),\"days\"));n.score+=c*i}),n.score>0?(n.recentUses.length>0&&(n.frecency=this.computeFrecency(a,n.score,{numOfRecentUses:o.length,maxTotalUse:null==t?void 0:t.totalUses})),this.usageHistory[r]=n):delete this.usageHistory[r]}),this.frequently=i()(this.usageHistory).map((e,t)=>{let n=this.lookupKey(t);return null==n?null:[n,e.frecency]}).filter(e=>null!==e).sortBy(e=>{let[t,n]=e;return-n}).map(e=>{let[t]=e;return t}).take(this.numFrequentlyItems).value(),this.dirty=!1,this.afterCompute(this.usageHistory,this._frequently)}get frequently(){return this.dirty&&this.compute(),this._frequently}set frequently(e){this._frequently=e}constructor({computeBonus:e,computeWeight:t=_,computeFrecency:n=p,calculateMaxTotalUse:r=!1,lookupKey:i,afterCompute:a,numFrequentlyItems:s=f,maxSamples:l=d}){o(this,\"dirty\",void 0),o(this,\"_frequently\",void 0),o(this,\"numFrequentlyItems\",void 0),o(this,\"maxSamples\",void 0),o(this,\"computeBonus\",void 0),o(this,\"computeWeight\",void 0),o(this,\"computeFrecency\",void 0),o(this,\"calculateMaxTotalUse\",void 0),o(this,\"lookupKey\",void 0),o(this,\"usageHistory\",void 0),o(this,\"afterCompute\",void 0),this.computeBonus=e,this.computeWeight=t,this.computeFrecency=n,this.calculateMaxTotalUse=r,this.afterCompute=a,this.lookupKey=i,this.usageHistory={},this.frequently=[],this.maxSamples=l,this.numFrequentlyItems=s,this.dirty=!1}}"}]