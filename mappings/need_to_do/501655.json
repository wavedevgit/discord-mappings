[{"code":"class P{_getParticipantsForUser(e,t){var n,r,i;let s,b=[],O=f.Z.getVoiceStateForChannel(this.channelId,e);if(null==O)return b;let S=d.default.getUser(e);if(null==S)return null!=this.guildId&&m.Z.isPublic(this.channelId)&&l.Z.requestMember(this.guildId,e),b;let I=null!=t?t[0]:null,T=null!=this.guildId?c.ZP.getMember(this.guildId,e):null,C=null!=(n=null==T?void 0:T.nick)?n:_.ZP.getName(this.guildId,this.channelId,S),A={user:S,userNick:_.ZP.getName(this.guildId,this.channelId,S),nick:C,comparator:(0,p.sQ)(O,C),voiceState:O,role:(0,E.H)(this.guildId,e),speaker:h.ZP.isSpeaker(e,this.channelId),member:T,blocked:u.Z.isBlocked(S.id),ignored:u.Z.isIgnored(S.id),isFriend:u.Z.isFriend(S.id),connectedOn:null!=(r=null==I?void 0:I.connectedOn)?r:Date.now()},N=v(y({},A),{type:\"VOICE\",id:S.id,rtsState:(0,g.gf)(O)});b.push(N);let P=null!=(i=o.Z.getStreamForUser(e,this.guildId))?i:o.Z.getActiveStreamForUser(e,this.guildId);if(null!=P&&P.channelId===this.channelId){let e=(0,a.V9)(P);s=v(y({},A),{id:e,type:\"STREAM\",rtsState:g.xO.NONE}),b.push(s)}return b}updateParticipant(e){let t=this.participants[e],n=this._getParticipantsForUser(e,t);return(null!=t||0!==n.length)&&(null==t||t.forEach(e=>{this._participantsIndex.delete(e.id),this._requestToSpeakIndex.delete(e.id)}),n.forEach(t=>{this._participantsIndex.set(t.id,t),t.id===e&&A(t.rtsState)?this._requestToSpeakIndex.set(e,t):this._requestToSpeakIndex.delete(e)}),this.participants[e]=n,!0)}rebuild(){let e=s.Z.getChannel(this.channelId);if(null==e||!e.isGuildStageVoice())return!1;let t=new Set(Object.keys(f.Z.getVoiceStatesForChannel(e.id)));return this._participantsIndex.clear(),this._requestToSpeakIndex.clear(),this.participants={},t.forEach(e=>this.updateParticipant(e)),!0}get version(){return this._participantsIndex.version}size(e){return this._participantsIndex.size(e)}toArray(e){return this._participantsIndex.values(e,!0)}getParticipant(e){var t;return null!=(t=this._participantsIndex.get(e))?t:null}get requestToSpeakVersion(){return this._requestToSpeakIndex.version}getRequestToSpeakParticipants(){return this._requestToSpeakIndex.values(void 0,!0)}constructor(e){var t;b(this,\"channelId\",void 0),b(this,\"guildId\",void 0),b(this,\"participants\",{}),b(this,\"_participantsIndex\",new r.h(N,T)),b(this,\"_requestToSpeakIndex\",new r.h(()=>[],C)),this.channelId=e,this.guildId=null==(t=s.Z.getChannel(e))?void 0:t.getGuildId()}}"}]