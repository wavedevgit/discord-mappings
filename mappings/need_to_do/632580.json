[{"code":"async function y(e){let{setPurchaseState:t,setHasAcceptedTerms:n,setIsSubmitting:r,setPurchaseError:m,hasRedirectURL:E,setHasRedirectURL:y,isGift:O,baseAnalyticsData:v,analyticsLocation:S,analyticsLocations:I,flowStartTime:T,subscriptionPlan:C,planGroup:A,trialId:N,priceOptions:P,paymentSource:w,isPrepaidPaymentPastDue:R,openInvoiceId:D,premiumSubscription:x,onNext:L,metadata:j,sku:M,skuPricePreview:k,purchaseType:U,referralCode:G,loadId:Z,giftInfoOptions:F,invoicePreview:B,orderId:V}=e;t(p.A.PURCHASING),n(!0),r(!0),a.Z.wait(s.fw),m(null);try{let e,n,r,a;if(d.default.track(_.rMx.PAYMENT_FLOW_COMPLETED,b(g({},v),{subtotal:null==B?void 0:B.subtotal,tax:null==B?void 0:B.tax,expected_amount:null==B?void 0:B.total,expected_currency:null==B?void 0:B.currency,duration_ms:Date.now()-T})),E)return;if(U===_.GZQ.ONE_TIME)i()(null!=M,\"SKU must exist and be fetched.\"),i()(null!=k,\"SKUPricePreview must exist.\"),e=await (0,c.ZZ)(M.applicationId,M.id,{expectedAmount:k.amount,expectedCurrency:k.currency,isGift:O,paymentSource:w,loadId:Z,giftInfoOptions:F,orderId:V});else{i()(null!=C,\"Missing subscriptionPlan\"),i()(null!=B,\"Missing invoicePreview\");let t={amount:B.total,currency:B.currency},n=(0,f.BK)((0,f.aS)(C.id,!1,!1,P));if(null!=x){let e=(0,f.al)(x,C.id,1,new Set(A));e=(0,f.gB)(e),n=(0,f.UX)(e,P.currency.toLowerCase(),P.paymentSourceId)}if(O){let t=B.total,n=B.currency;e=await (0,c.ZZ)(h.CL,C.skuId,{expectedAmount:t,expectedCurrency:n,paymentSource:w,subscriptionPlanId:C.id,isGift:!0,loadId:Z,giftInfoOptions:F,orderId:V})}else if(R&&null!=D&&null!=w&&null!=x)e=_.Uk1.has(w.type)?await (0,o.G)(x,D,w,P.currency):await (0,o.Mg)(x,{paymentSource:w,currency:P.currency},t,n,I,S,Z);else if(null!=x){let r=(0,f.al)(x,C.id,1,new Set(A)),i={paymentSource:w,currency:P.currency};x.status===_.O0b.PAUSED&&(i.status=_.O0b.ACTIVE),x.isPausedAllowsResumeButNotUpdates||(i.items=r),e=await (0,o.Mg)(x,i,t,n,I,S,Z)}else e=await (0,l.Ld)({planId:C.id,currency:P.currency,paymentSource:w,trialId:N,metadata:j,referralCode:G,loadId:Z,expectedInvoicePrice:t,expectedRenewalPrice:n})}if(e.redirectConfirmation)return void y(null!=e.redirectURL);t(p.A.COMPLETED),\"subscription\"in e?n=null!=e.subscription?u.Z.createFromServer(e.subscription):null:\"entitlements\"in e&&(r=null!=e.entitlements?e.entitlements:void 0),\"appliedUserDiscounts\"in e&&(a=null!=e.appliedUserDiscounts&&e.appliedUserDiscounts.length>0?e.appliedUserDiscounts:void 0),L(n,r,a)}catch(e){t(p.A.FAIL),m(e),d.default.track(_.rMx.PAYMENT_FLOW_FAILED,b(g({},v),{payment_error_code:null==e?void 0:e.code,payment_source_id:null==w?void 0:w.id,payment_source_type:null==w?void 0:w.type,duration_ms:Date.now()-T}))}finally{E||r(!1)}}"}]