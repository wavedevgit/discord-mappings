[{"code":"class k extends i.Component{_getEditorWindow(){var e,t,n,r,i;let a=null==(i=this.ref)||null==(r=i.current)||null==(n=r.getSlateEditor)||null==(t=n.call(r))||null==(e=t.windowContext)?void 0:e.renderWindow;if(null==this._cachedEditorWindow||this._cachedEditorWindow!==a){if(null!=this._cachedEditorWindow&&null==a)return null;this._cachedEditorWindow=null!=a?a:window}return this._cachedEditorWindow}componentDidMount(){this.props.focused&&requestAnimationFrame(()=>this.focus()),document.addEventListener(\"selectionchange\",this.handleSelectionChange),window.addEventListener(\"beforeunload\",this.handleBeforeUnload),this._initTimeoutId=setTimeout(()=>void this._getEditorWindow(),M)}componentDidUpdate(e){if(this.fixFocus(e),this.props.useSlate!==e.useSlate){var t,n;let e;e=this.props.useSlate?this.props.textValue:(0,A.sk)(this.props.richValue,{mode:\"plain\"}),null==(t=(n=this.props).onChange)||t.call(n,null,e,(0,v.JM)(e))}else this.props.textValue!==e.textValue&&this.saveCurrentTextThrottled()}componentWillUnmount(){var e,t;this.saveCurrentText(),null==(e=(t=this)._unsubscribe)||e.call(t),window.removeEventListener(\"beforeunload\",this.handleBeforeUnload),document.removeEventListener(\"selectionchange\",this.handleSelectionChange),this._focusBlurQueue=null,this._unsubscribe=null,this._cachedEditorWindow=null,null!=this._initTimeoutId&&clearTimeout(this._initTimeoutId)}blur(){let e=this.ref.current;null!=e&&e.blur()}submit(e){var t;null==(t=this.ref.current)||t.submit(e)}insertEmoji(e){let{emoji:t,willClose:n}=e,r=this.ref.current;null!=t&&null!=r&&(r.insertEmoji({emoji:t,addSpace:n}),n&&this.focus())}insertGIF(e){let{textValue:t}=this.props,n=this.ref.current;null!=e&&null!=n&&(t.endsWith(\" \")||n.insertText(\" \",void 0,!1),n.insertText(e.url))}insertSound(e){let{textValue:t}=this.props,n=this.ref.current;null!=e&&null!=n&&(t.endsWith(\" \")||n.insertText(\" \",void 0,!1),n.insertText(\"<sound:\".concat(e.guildId,\":\").concat(e.soundId,\">\"),void 0,!0))}handleOuterClick(){this.focus()}clearValue(){let{channel:e,type:t}=this.props;this.setState({focused:!0,submitting:!1}),u.Z.saveDraft(e.id,\"\",t.drafts.type)}getCurrentWord(){var e;let t=this.ref.current;return null!=(e=null==t?void 0:t.getCurrentWord())?e:{word:null,isAtStart:!1}}insertAutocomplete(e,t,n){let r=this.ref.current;return null==r?void 0:r.insertAutocomplete(e,t,n)}insertInlineAutocompleteElement(e){let t=this.ref.current;return null==t?void 0:t.insertInlineAutocompleteInput(e)}replaceInlineAutocompleteInput(e,t,n){let r=this.ref.current;return null==r?void 0:r.replaceInlineAutocompleteInput(e,t,n)}getCurrentCommandOption(){var e,t;let n=this.ref.current;return null!=(t=null==n||null==(e=n.getCurrentCommandOption)?void 0:e.call(n))?t:null}getCurrentCommandOptionValue(){var e,t;let n=this.ref.current;return null!=(t=null==n||null==(e=n.getCurrentCommandOptionValue)?void 0:e.call(n))?t:[]}getCommandOptionValues(){var e,t;let n=this.ref.current;return null!=(t=null==n||null==(e=n.getCommandOptionValues)?void 0:e.call(n))?t:{}}getFirstText(){var e;let t=this.ref.current;return null!=(e=null==t?void 0:t.getFirstText())?e:null}getSlateEditor(){var e,t;let n=this.ref.current;return null!=(t=null==n||null==(e=n.getSlateEditor)?void 0:e.call(n))?t:null}fixFocus(e){e.focused&&!this.props.focused?this.blur():!e.focused&&this.props.focused&&this.focus()}appendText(e,t){var n;let r=!(arguments.length>2)||void 0===arguments[2]||arguments[2];null==(n=this.ref.current)||n.insertText(e,t,r)}getPlaceholder(){let{disabled:e,placeholder:t,isPreviewing:n,showValueWhenDisabled:r}=this.props;return e&&!n?r?\"\":P.intl.string(P.t.IYKTTc):t}render(){var e,t,n,i,a,s;let{textValue:l,richValue:u,disabled:d,onChange:f,onKeyDown:p,onResize:_,onSubmit:h,onSubmitFailure:m,channel:g,type:b,useSlate:y,spellcheckEnabled:S,useNewSlashCommands:I,canOnlyUseTextCommands:A,className:P,id:R,required:x,maxCharacterCount:j,allowNewLines:M,isEditorIdle:k,currentAutocompleteType:U,\"aria-describedby\":G,\"aria-labelledby\":Z,accessibilityLabel:F,showValueWhenDisabled:B}=this.props,{submitting:V,popup:H}=this.state,Y={channel:g,className:o()(P,w.textArea,{[w.textAreaSlate]:y,[w.textAreaDisabled]:d||V}),id:R,placeholder:this.getPlaceholder(),required:x,accessibilityLabel:F,disabled:d||!1,submitting:V,isEdit:b===O.Ie.EDIT,onFocus:this.handleFocus,onBlur:this.handleBlur,onPaste:this.handlePaste,onTab:this.handleTab,onEnter:this.handleEnter,moveSelection:this.handleMoveSelection,maybeShowAutocomplete:this.maybeShowAutocomplete,hideAutocomplete:this.hideAutocomplete,allowNewLines:M,onChange:f,onResize:_,onKeyDown:p,onSubmit:h,textAreaPaddingClassName:o()({[w.textAreaForPostCreation]:b===O.Ie.CREATE_FORUM_POST,[w.textAreaCustomGift]:b===O.Ie.CUSTOM_GIFT,[w.textAreaForUserProfile]:b===O.Ie.USER_PROFILE,[w.textAreaForOverlayInlineReply]:b===O.Ie.OVERLAY_INLINE_REPLY}),spellcheckEnabled:S,useNewSlashCommands:I,isEditorIdle:k,currentAutocompleteType:U,disableAutoFocus:c.tq||null!=(n=b.disableAutoFocus)&&n,disableEnterToSubmit:null!=(i=null==(e=b.submit)?void 0:e.disableEnterToSubmit)&&i,\"aria-controls\":null!=(a=H.id)?a:void 0,\"aria-haspopup\":\"listbox\",\"aria-expanded\":null!==H.id||void 0,\"aria-activedescendant\":null!=(s=H.activeDescendant)?s:void 0,\"aria-invalid\":l.length>j,\"aria-describedby\":G,\"aria-labelledby\":Z,\"aria-autocomplete\":\"list\"},W=y?(0,r.jsx)(C.Z,L(D({ref:this.ref},Y),{type:b,value:d&&!B?(0,v.JM)(\"\"):u,canUseCommands:null==(t=b.commands)?void 0:t.enabled,canOnlyUseTextCommands:A,onSubmitFailure:m})):(0,r.jsx)(T.Z,L(D({ref:this.ref},Y),{value:d&&!B?\"\":l}));return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(E.d9,{event:N.CkL.INSERT_TEXT,handler:this.handleInsertText}),(0,r.jsx)(E.d9,{event:N.CkL.CLEAR_TEXT,handler:this.handleClearText}),W]})}constructor(e){var t;super(e),t=this,R(this,\"ref\",i.createRef()),R(this,\"_focusBlurQueue\",Promise.resolve()),R(this,\"_unsubscribe\",void 0),R(this,\"_initTimeoutId\",null),R(this,\"_cachedEditorWindow\",null),R(this,\"handleSelectionChange\",()=>{if(this.props.focused){var e,t,n;this.props.onSelectionChanged(null==(t=(n=document).getSelection)||null==(e=t.call(n))?void 0:e.toString())}}),R(this,\"focus\",()=>{var e;null==(e=this._focusBlurQueue)||e.then(()=>{this.setState({focused:!0},()=>{let e=this.ref.current;null!=e&&e.focus()})})}),R(this,\"saveCurrentText\",function(){let e=!(arguments.length>0)||void 0===arguments[0]||arguments[0],{type:n,channel:r}=t.props;n.drafts.autoSave&&(e&&t.saveCurrentTextThrottled.cancel(),t.handleSaveCurrentText(r.id))}),R(this,\"handleBeforeUnload\",()=>this.saveCurrentText()),R(this,\"saveCurrentTextThrottled\",l().throttle(this.saveCurrentText.bind(this,!1),500)),R(this,\"handleEnter\",e=>{var t,n;return null==(t=(n=this.props).onEnter)?void 0:t.call(n,e)}),R(this,\"handleTab\",()=>{var e,t;return null==(e=(t=this.props).onTab)?void 0:e.call(t)}),R(this,\"handleMoveSelection\",e=>{var t,n;return null==(t=(n=this.props).onMoveSelection)?void 0:t.call(n,e)}),R(this,\"maybeShowAutocomplete\",()=>{var e,t;return null==(e=(t=this.props).onMaybeShowAutocomplete)?void 0:e.call(t)}),R(this,\"hideAutocomplete\",()=>{var e,t;return null==(e=(t=this.props).onHideAutocomplete)?void 0:e.call(t)}),R(this,\"handleSaveCurrentText\",e=>{u.Z.saveDraft(e,this.props.textValue,this.props.type.drafts.type)}),R(this,\"handleClearText\",()=>{var e,t;null==(e=(t=this.props).onChange)||e.call(t,null,\"\",(0,v.JM)(\"\"))}),R(this,\"handleInsertText\",e=>{let{plainText:t,rawText:n,addSpace:r=!1}=e;this.props.disabled||(this.appendText(t,n,r),this.focus())}),R(this,\"handleFocus\",e=>{let{onFocus:t}=this.props,{focused:n}=this.state;null==t||t(e),n||this.setState({focused:!0})}),R(this,\"handleBlur\",e=>{let{onBlur:t}=this.props,{focused:n}=this.state;null==t||t(e),n&&this.setState({focused:!1})}),R(this,\"handlePaste\",e=>{var t,n,r;let i=null==(n=e.target)||null==(t=n.ownerDocument)?void 0:t.defaultView,{channel:a,canPasteFiles:o,uploadPromptCharacterCount:s,promptToUpload:l,maxCharacterCount:c,type:u}=this.props,m=null!=i?(0,I.im)(i):null,E=(0,I.Mo)(),b=null!=(r=null!=m?m:E)?r:a,y=(0,I._K)(i,this._getEditorWindow())?a:b;if(null==l||!y.isPrivate()&&!o||y.isPrivate()&&y.isManaged())return!1;let O=e=>{var t,n;let r=h.Z.getActiveCommand(y.id);if(null==r)return l(e,y,u.drafts.type,{requireConfirm:!0,origin:\"clipboard\"});let i=null!=(t=u.drafts.commandType)?t:u.drafts.type,a=null,o=h.Z.getActiveOption(y.id);null!=(a=(null==o?void 0:o.type)===p.jw.ATTACHMENT?o:null==(n=r.options)?void 0:n.find(e=>{if(e.type===p.jw.ATTACHMENT)return null==g.Z.getUpload(y.id,e.name,i)}))&&d.Z.setFile({channelId:y.id,id:a.name,draftType:i,file:{id:a.name,platform:_.ow.WEB,file:e[0]}})},v=null!=s?s:c,{files:S,errors:T}=U(e.clipboardData,u.uploadLongMessages?v:null);return(j(\"onPaste\",[...e.clipboardData.items].map(e=>{if(\"file\"!==e.kind)return{kind:e.kind,type:e.type};{let t=e.getAsFile();return{kind:e.kind,type:e.type,name:null==t?void 0:t.name,path:null==t?void 0:t.path}}})),0===S.length)?((null==T?void 0:T.some(e=>{let{error:t}=e;return\"is_directory\"===t}))&&(0,f.openUploadError)({title:P.intl.string(P.t.azO1Pe),help:P.intl.string(P.t[\"Koklr/\"])}),!1):(e.preventDefault(),e.stopPropagation(),this.saveCurrentText(),O(S),this.focus(),!0)}),this._unsubscribe=S.p8.subscribe(e=>{requestAnimationFrame(()=>{this.setState({popup:e})})}),this.state={focused:!1,submitting:!1,popup:S.p8.getState()}}}"}]